<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EjLog WMS - Warehouse Management System</title>

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <!-- CSP disabled for production static server compatibility -->

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <meta name="description" content="EjLog Warehouse Management System - Sistema di gestione magazzino automatizzato">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- PWA Theme Color -->
    <meta name="theme-color" content="#10b981">

    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="/icon-192x192.png">
  </head>
  <body>
    <div id="root"></div>
    <!-- QR/Barcode Scanner Container (hidden by default, shown when camera scanner active) -->
    <div id="qr-reader" style="display: none;"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('[PWA] Service Worker registered:', registration.scope);

              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('[PWA] New Service Worker installing...');

                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('[PWA] New content available, refresh to update.');
                    // Optional: Show update notification to user
                  }
                });
              });
            })
            .catch(error => {
              console.error('[PWA] Service Worker registration failed:', error);
            });
        });
      }
    </script>
  </body>
</html>
